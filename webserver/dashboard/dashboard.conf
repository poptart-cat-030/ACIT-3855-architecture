server {
    listen 80;
    server_name localhost;

    # Serve the static dashboard files (HTML, JS, CSS)
    location / {
        root /usr/share/nginx/html;
        index index.html;
        # Try serving the file, otherwise return 404
        try_files $uri $uri/ =404; 
    }

    # Proxy for PROCESSING Service (port 8100)
    # The URL requested by the browser starts with /api/processing/
    location /api/processing/ {
        # Strip the prefix (/api/processing/) before sending to the service
        # i.e just get the /stats part of the URL (stored in $1)
        rewrite ^/api/processing/(.*) /$1 break; 
        
        # Forward request to the Docker service name and internal port
        # Result of URL rewrite is appended to the end of the URL
        proxy_pass http://processing:8100;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Proxy for ANALYZER Service (port 8110)
    # The URL requested by the browser starts with /api/analyzer/
    location /api/analyzer/ {
        # Strip the prefix (/api/analyzer/) before sending to the service
        # i.e just get the /stats (or /hair/volume or /hair/type) part of the URL (stored in $1)
        rewrite ^/api/analyzer/(.*) /$1 break;
        
        # Forward request to the Docker service name and internal port
        # Result of URL rewrite is appended to the end of the URL
        proxy_pass http://analyzer:8110;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Proxy for HEALTH Service (port 8120)
    # The URL requested by the browser starts with /api/health/
    location /api/health/ {
        # Strip the prefix (/api/health/) before sending to the service
        # i.e just get the /statuses part of the URL (stored in $1)
        rewrite ^/api/health/(.*) /$1 break;
        
        # Forward request to the Docker service name and internal port
        # Result of URL rewrite is appended to the end of the URL
        proxy_pass http://health:8120;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # # Proxy for CHECK Service (port -------)
    # # The URL requested by the browser starts with /api/------------------/
    # location /api/--------------/ {
    #     # Strip the prefix (/api/--------------/) before sending to the service
    #     # i.e just get the /--------------- part of the URL (stored in $1)
    #     rewrite ^/api/----------------/(.*) /$1 break;
        
    #     # Forward request to the Docker service name and internal port
    #     # Result of URL rewrite is appended to the end of the URL
    #     proxy_pass http://------------------:-------------;
        
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    # }
}